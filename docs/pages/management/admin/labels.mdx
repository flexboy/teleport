---
title: Labels
description: Labeling Teleport resources
---

Teleport allows you to add arbitrary key-value pairs to applications, servers,
databases, and other resources in your cluster. You can use labels to do the following:

- Filter the resources returned when running `tctl` and `tsh` commands.
- Limit the resources that Teleport roles can access.

This guide demonstrates how to add labels to Teleport resources.
You can use the instructions in this guide to add labels for any type of resource managed by Teleport.

## Static and dynamic labels

The labels you assign to resources can be **static labels** or **dynamic labels**.

- Static labels are hardcoded in the `teleport` configuration file and don't change 
while the `teleport` process is running. For example, you might use a static label to identify 
the resources in a `staging` or `production` environment.
- Dynamic labels—also known as **label commands**—allow you to generate labels at runtime. 
With a dynamic label, the `teleport` process executes an external command on its host at a configurable 
frequency and the output of the command becomes the label value.

You can add both static and dynamic labels for the same resource.
Hpwever, if you add static labels that use the same key but with multiple values, only the last 
key-value pair is used.

Dynamic labels are especially useful for decoupling a label value from the Teleport configuration. 
For example, if you start Teleport on an Amazon EC2 instance, you can use a dynamic label to set the 
`region` value based on the result from a command sent to the EC2 instance 
[metadata API](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-categories.html).
The dynamic label enables you to use the same configuration for each server in an Amazon Machine Image 
and to filter and limit access to servers by AWS region.

## Prerequisites

(!docs/pages/includes/edition-prereqs-tabs.mdx!)

- (!docs/pages/includes/tctl.mdx!)

## Step 1/3. Install Teleport

1. Select a host for running the Teleport agent.

1. Select an edition, then follow the instructions for that edition to install Teleport.

   (!docs/pages/includes/install-linux.mdx!)

1. Generate an invite token for your local computer.
   
   The invite token is required for the local computer to join the Teleport cluster.   
   The following example generates a new token that is valid for five minutes:
   
   ```code
   $ tctl tokens add --ttl=5m --type=node
   # The invite token: (=presets.tokens.first=)
   ```

1. List all generated non-expired tokens by running the following command:
   
   ```code
   $ tctl tokens ls
   # Token                            Type            Expiry Time
   # ------------------------         -----------     ---------------
   # (=presets.tokens.first=)         Node            25 Sep 18 00:21 UTC
   ```

1. Copy the token for the computer and assign it to an environment variable:
   
   ```code
   $ export INVITE_TOKEN=<token>
   ```

## Step 2/3. Apply a static label

You can configure static labels by editing the Teleport configuration file, then
starting Teleport.

To add a static label:

1. Open the `/etc/teleport.yaml` file in an editor on the computer where you installed the Teleport agent.

1. Paste the appropriate content for your environment:

   <ScopedBlock scope={["oss", "enterprise"]}>
   
   ```yaml
   version: v3
   teleport:
     # The address of your Auth Service.
     auth_server: tele.example.com:3025
     # Or, you can also use a Proxy Service
     # address, e.g., tele.example.com:443, if your Auth Service is not
     # exposed to the internet.
     proxy_server: tele.example.com:443

   auth_service:
     enabled: false
   
   proxy_service:
     enabled: false
   
   ssh_service:
     enabled: true
     # Static labels are simple key/value pairs:
     labels:
       environment: dev
   ```

   </ScopedBlock>
   <ScopedBlock scope={["cloud"]}>

   ```yaml
   version: v3
   teleport:
     # Your Teleport Cloud tenant address
     proxy_server: mytenant.teleport.sh:443
   
   auth_service:
     enabled: false
   
   proxy_service:
     enabled: false
   
   ssh_service:
     enabled: true
     # Static labels are simple key/value pairs:
     labels:
       environment: dev
   ```
   
   </ScopedBlock>

1. Start Teleport with the invite token you created earlier:
   
   ```code
   $ sudo teleport start --token=${INVITE_TOKEN?}
   ```

1. Verify that you have added the label by running the following command 
on your local computer. 
   
   Your Teleport user must be authorized to access the Node.
   
   ```code
   $ tsh ls --query 'labels["environment"]=="dev"'
   Node Name    Address    Labels
   ------------ ---------- ---------------
   bdcb47b87ad6 ⟵ Tunnel environment=dev
   ```

<Details title="Don't see your Node?">

1. Check the logs for your host to ensure the SSH Service is running. 
   
   Your logs should resemble the following:
   
   ```text
   2022-04-27T14:44:23Z INFO [NODE:1]    Service is starting in tunnel mode. service/service.go:1993
   2022-04-27T14:44:23Z INFO [PROC:1]    The new service has started successfully. Starting syncing rotation status with period 10m0s. service/connect.go:482
   2022-04-27T14:44:23Z INFO             Service has started successfully. service/service.go:523
   2022-04-27T14:44:24Z INFO [NODE:PROX] Connected. addr:172.17.0.2:40184 remote-addr:192.0.2.0:443 leaseID:1 target:teleport.example.com:443 reversetunnel/agent.go:409
   ```

1. Verify that your Teleport user has a login on the host.
   
   Yoou can run the following command to get the current logins for your user:
   
   <ScopedBlock scope={["oss"]}>
   
   ```code
   $ tsh status
   > Profile URL:        https://teleport.example.com:443
     Logged in as:       myuser
     Cluster:            teleport.example.com
     Roles:              access, editor
     Logins:             -teleport-nologin-d4bc1dad-ce49-4bbe-925d-a67f8d2d6afe
     Kubernetes:         enabled
     Valid until:        2022-04-27 22:26:50 -0400 EDT [valid for 11h40m0s]
     Extensions:         permit-agent-forwarding, permit-port-forwarding, permit-pty
   ```
   </ScopedBlock>
   <ScopedBlock scope={["enterprise"]}>
   
   ```code
   $ tsh status
   > Profile URL:        https://teleport.example.com:443
     Logged in as:       myuser
     Cluster:            teleport.example.com
     Roles:              access, editor, reviewer
     Logins:             -teleport-nologin-d4bc1dad-ce49-4bbe-925d-a67f8d2d6afe
     Kubernetes:         enabled
     Valid until:        2022-04-27 22:26:50 -0400 EDT [valid for 11h40m0s]
     Extensions:         permit-agent-forwarding, permit-port-forwarding, permit-pty
   ```
   </ScopedBlock>
   <ScopedBlock scope={["cloud"]}>
   
   ```code
   $ tsh status
   > Profile URL:        https://mytenant.teleport.sh:443
     Logged in as:       myuser
     Cluster:            mytenant.teleport.sh
     Roles:              access, editor, reviewer
     Logins:             -teleport-nologin-d4bc1dad-ce49-4bbe-925d-a67f8d2d6afe
     Kubernetes:         enabled
     Valid until:        2022-04-27 22:26:50 -0400 EDT [valid for 11h40m0s]
     Extensions:         permit-agent-forwarding, permit-port-forwarding, permit-pty
   ```
   </ScopedBlock>

In this example, `-teleport-nologin-d4bc1dad-ce49-4bbe-925d-a67f8d2d6afe` means
that no logins have been assigned to the user.

To add logins, retrieve your user configuration as YAML:

```code
# Replace "myuser" with your Teleport username
$ tctl get user/myuser > user.yaml
```

Edit the `logins` field for your user. Each login must exist as a user on the
host:

```diff
     db_users: null
     kubernetes_groups: null
     kubernetes_users: null
-    logins: null
+    logins:
+      - root
     windows_logins: null
 version: v2
```

Apply your changes:

```code
$ tctl create -f user.yaml
user "myuser" has been updated
```

Log out of your cluster, then log in again. You should now see your Node when
you run `tsh ls`.

</Details>

<Details title="Hidden labels">

If you want to use labels for RBAC purposes but don't want to see the labels
in the UI, you can put them in the hidden namespace by prefixing the label's
key with `teleport.hidden/`, for example `teleport.hidden/account-id`.
</Details>

## Step 3/3. Apply dynamic labels using commands

Before following this step, stop Teleport on your Node.

As with static labels, you can apply dynamic labels by editing the
Teleport configuration file.

Edit `/etc/teleport.yaml` to define a `commands` array as shown below:

<ScopedBlock scope={["oss", "enterprise"]}>

```yaml
version: v3
teleport:
  auth_server: tele.example.com:3025

auth_service:
  enabled: false

proxy_service:
  enabled: false

ssh_service:
  enabled: "yes"
  # Configure dynamic labels using the "commands" field:
  commands:
  - name: hostname
    command: [hostname]
    period: 1m0s
  - name: arch
    command: [uname, -p]
    # This setting tells Teleport to execute the command above
    # once an hour. This value cannot be less than one minute.
    period: 1h0m0s
```

</ScopedBlock>
<ScopedBlock scope={["cloud"]}>

```yaml
version: v3
teleport:
  proxy_server: mytenant.teleport.sh:443

auth_service:
  enabled: false

proxy_service:
  enabled: false

ssh_service:
  enabled: "yes"
  # Configure dynamic labels using the "commands" field:
  commands:
  - name: hostname
    command: [hostname]
    period: 1m0s
  - name: arch
    command: [uname, -p]
    # This setting tells Teleport to execute the command above
    # once an hour. This value cannot be less than one minute.
    period: 1h0m0s
```

</ScopedBlock>

Notice that the `command` setting is an array where the first element
is a valid executable and each subsequent element is an argument.

This is valid syntax:

```yaml
command: ["/bin/uname", "-m"]
```

This is invalid syntax:

```yaml
command: ["/bin/uname -m"]
```

If you want to pipe several bash commands together, here's how to do it. Notice
how `'` and `"` are interchangeable, so you can use them for nested quotations.

```yaml
command: ["/bin/sh", "-c", "uname -a | egrep -o '[0-9]+\\.[0-9]+\\.[0-9]+'"]
```

<Notice type="warning">

When configuring a command to generate dynamic labels, the executable named
within your command must be the path to a valid file. The executable permission
bit must be set and shell scripts must have a
[shebang line](https://en.wikipedia.org/wiki/Shebang_\(Unix\)).

</Notice>

Once you have configured your labels, start Teleport with the invite token you
created earlier:

```code
$ sudo teleport start --token=${INVITE_TOKEN?}
```

Verify that you have added the labels by running the following on your local
machine. Your Teleport user must be authorized to access the Node.

```code
$ tsh ls
Node Name         Address    Labels
----------------- ---------- ---------------
ip-192-0-2-0      ⟵ Tunnel arch=x86_64,hostname=ip-172-30-156-233
```

<Details title="Problems re-joining the Node?">

Try creating another invite token using the `tctl tokens add` command from earlier
and starting your Node again.

If this doesn't work, delete the directory your Node uses to maintain its state,
`/var/lib/teleport`, and try again.

</Details>

## Next steps: Using labels

Once you have labeled your resources, you can refer to your labels when running
`tsh` and `tctl` commands to filter the resources that the commands will query.
For more information, see
[Resource filtering](../../reference/predicate-language.mdx).

You can also use labels to limit the access that different roles have to
specific classes of resources. For more information, see
[Teleport Role Templates](../../access-controls/guides/role-templates.mdx).
