---
title: Add Labels to Resources
description: Labeling Teleport resources
---

Teleport allows you to add arbitrary key-value pairs to applications, servers,
databases, and other resources in your cluster. You can use labels to do 
the following:

- Filter the resources returned when running `tctl` and `tsh` commands.
- Limit the resources that Teleport roles can access.

This guide demonstrates how to add labels to enrolled server resources.
However, you can use these instructions to add labels for any type 
of resource managed by Teleport.

## Static and dynamic labels

The labels you assign to resources can be **static labels** or **dynamic labels**.

- Static labels are hardcoded in the `teleport` configuration file and don't change 
while the `teleport` process is running. For example, you might use a static label to identify 
the resources in a `staging` or `production` environment.
- Dynamic labels—also known as **commands-based labels**—allow you to generate labels at runtime. 
With a dynamic label, the `teleport` process executes an external command on its host at 
a configurable frequency and the output of the command becomes the label value.

You can add multiple static and dynamic labels for the same resource.
However, if you add static labels that use the same key but with different values, only the first 
key-value pair is used.

Dynamic labels are especially useful for decoupling a label value from the Teleport configuration. 
For example, if you start Teleport on an Amazon EC2 instance, you can use a dynamic label to set the 
`region` value based on the result from a command sent to the EC2 instance 
[metadata API](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-categories.html).
The dynamic label enables you to use the same configuration for each server in an Amazon Machine Image 
but filter and limit access to the servers based on their AWS region.

## Prerequisites

(!docs/pages/includes/edition-prereqs-tabs.mdx!)

(!docs/pages/includes/tctl.mdx!)

## Step 1/3. Install Teleport

1. Select a host for running the Teleport agent.

1. (!docs/pages/includes/install-linux.mdx!)

1. Generate an invitation token for your local computer.
   
   The invitation token is required for the local computer to join the Teleport cluster.   
   The following example generates a new token that is valid for five minutes and can be used 
   to enrolled a server, database, and application resource:
   
   ```code
   $ tctl tokens add --ttl=5m --type=node,db,app
   # The invite token: (=presets.tokens.first=)
   ```

1. List all generated non-expired tokens by running the following command:
   
   ```code
   $ tctl tokens ls
   # Token                            Type        Labels Expiry Time (UTC)               
   # -------------------------------- ----------- ------ ------------------------------- 
   # (=presets.tokens.first=)         Node,Db,App        10 Aug 23 19:49 UTC (4m11s) 
   ```

1. Copy the token and assign it to an environment variable on the computer you are enrolling 
as a resource:
   
   ```code
   $ export INVITE_TOKEN=<token>
   ```

## Step 2/3. Apply a static label

You can configure static labels by editing the Teleport configuration file, then
starting Teleport.

To add a static label:

1. Open the Teleport configuration file—by default, `/etc/teleport.yaml`—in an editor on the computer 
where you installed the Teleport agent.

1. Locate the `labels` configuration under the `ssh_service` section.

1. Add the static label key and value. 
   For example, add `environment` as the label key and `dev` as the value:

   ```yaml
   ssh_service:
     enabled: true
     labels:
       environment: dev
   ```

1. Save your changes and close the file.

1. Start Teleport with the invitation token you saved in the `INVITE_TOKEN` environment variable:
   
   ```code
   $ sudo teleport start --token=${INVITE_TOKEN?}
   ```

1. Verify that you have added the label by running the following command 
on your local computer. 
      
   ```code
   $ tsh ls --query 'labels["environment"]=="dev"'
   ```

   You should see output similiar to the following:

   ```code
   Node Name        Address    Labels                                                                                                       
   ---------------- ---------- ------------------------------------------------------------------------
   ip-192-168-13-57 ⟵ Tunnel   environment=dev,hostname=ip-192-168-13-57,teleport.internal/resource-id
   ```

   #### Checking the status of your server

   If you don't see your server listed when you query for the label you added, you should verify that the 
   SSH Service is running on the server. Check the log for the server to verify that there are 
   messages similar to the following:
   
   ```text
   2023-08-07T22:22:21Z INFO [NODE:1]    Service is starting in tunnel mode. pid:149932.1 service/service.go:2630
   2023-08-07T22:22:21Z INFO [UPLOAD:1]  starting upload completer service pid:149932.1 service/service.go:2723
   2023-08-07T22:22:21Z INFO [PROC:1]    The new service has started successfully. Starting syncing rotation status...
   ```
   
   #### Checking your user profile
   
   If the SSH Service is running on the server, verify that your current Teleport user has a login on the local host.
   You can check the status of your user account by running the following command:
   
   ```code
   $ tsh status
   ```
      
   You should see output similar to the following with at least one login listed for your current user:
   
   ```code
   > Profile URL:        https://ajuba-aws.teledocs.click:443
     Logged in as:       lsgunn-admin
     Cluster:            ajuba-aws.teledocs.click
     Roles:              access, editor
     Logins:             root, ubuntu, ec2-user
     Kubernetes:         enabled
     Valid until:        2023-08-08 10:08:46 +0000 UTC [valid for 10h36m0s]
     Extensions:         login-ip, permit-agent-forwarding, permit-port-forwarding, permit-pty, private-key-policy
   ```
   
   If no valid local logins have been assigned to the user, you should update your current user profile to include
   at least one valid local login.
   
   To add logins to your current user:

   1. Retrieve your user configuration as YAML by replacing `myuser` with your Teleport username:
      
      ```code
      $ tctl get user/myuser > user.yaml
      ```
   
   1. Locat the `traits` section and update the `logins` field to specify one or more local users that exist 
   on the local host:

      ```diff
       traits:
         db_users: null
         kubernetes_groups: null
         kubernetes_users: null
      -  logins: null
      +  logins:
      +  - root
         windows_logins: null
      version: v2
      ```

   1. Apply your changes by running the following cmmand:

      ```code
      $ tctl create -f user.yaml
      user "myuser" has been updated
      ```

   1. Sign out, then sign back in to the cluseter and run `tsh ls`.

   For more information about managing logins for Teleport users, see [Local Users](../../management/admin/users).

#### Using hidden static labels

If you want to use labels for role-based access control but don't want to 
display the labels in command output or the Teleport Web UI, you can define them 
in a hidden namespace by prefixing the label key with `teleport.hidden/`.
For example:

```yaml
ssh_service:
  enabled: true
  labels:
    teleport.hidden/team-id: ai-lab-01
``` 

## Step 3/3. Apply dynamic labels using commands

As with static labels, you can apply dynamic labels by editing the
Teleport configuration file, then restarting the Teleport service on your server.

To add a command to generate a dynamic label:

1. Stop the Teleport service running on your server.

1. Open the Teleport configuration file—by default, `/etc/teleport.yaml`—in a text editor.

1. Locate the `commands` configuration under the `ssh_service` section.

1. Add a `command` array that runs the `uname` command with the `-p` argument to return the architecture of the 
host server every one hour. 
   
   For example, add the `name`, `command`, and `period` as follows:

   ```yaml
   ...
   ssh_service:
     enabled: "yes"
     labels:
       teleport.internal/resource-id: 1f2cdcc5-cde3-41fa-b390-bc872087821a
       environment: dev
     commands:
     - name: hostname
       command: [hostname]
       period: 1m0s
     - name: arch
       command: [uname, -p]
       period: 1h0m0s
   ```
   
   In the `command` setting, the first element is a valid executable. 
   Each subsequent element is an argument.
   The following syntax is valid:

   ```yaml
   command: ["/bin/uname", "-m"]
   ```
   
   The following syntax is not valid:

   ```yaml
   command: ["/bin/uname -m"]
   ```
   
   For more complex commands, you can use single (') and double (") 
   quotation marks interchangeablely to create nested expressions. 
   For example:

   ```yaml
   command: ["/bin/sh", "-c", "uname -a | egrep -o '[0-9]+\\.[0-9]+\\.[0-9]+'"]
   ```
   
   In configuring commands, keep the following in mind:
   
   - You must specify the path to a valid executable program or file. 
   - You must set the executable permission bit on any file you use as a command. 
   - Shell scripts must have a [shebang line](https://en.wikipedia.org/wiki/Shebang_\(Unix\)).
   
   The `period` setting specifies how frequently Teleport executes each command.
   In this eaxample, the `uname -p` command is executed every one hour (1h), zero minutes (0m),
   and zero seconds (0s). This value can't be less than one minute.

1. Save your changes and close the file.

1. Start Teleport with the invitation token you saved in the `INVITE_TOKEN` eni=vironment variable:

   ```code
   $ sudo teleport start --token=${INVITE_TOKEN?}
   ```

1. Verify that you have added the label by running the following command on your local
computer. Your Teleport user must be authorized to access the Node.

   ```code
   $ tsh ls
   ```

   You should see output similar to the following with both the `arch` and `environment` labels displayed:

   ```code
   Node Name        Address        Labels                                                                                                                   
   ---------------- -------------- ------------------------------------------------------------------------------------
   ip-192-168-13-57 ⟵ Tunnel       arch=x86_64,environment=dev,hostname=ip-192-168-13-57,teleport.internal/resource-id 
   ```

## Adding resources and restarting

In this guide, you learned how to add and apply a static label and a command-based dynamic label 
for a server resource. If you want to add labels for other resources—for example, a database 
or application—you might have to create another invitation token using the `tctl tokens add` command
and start the Teleport service again with the new token.

To restart a server with new resources:

1. Generate a new invitation token.
   
   ```code
   $ tctl tokens add --type=app
   ```

1. Delete the directory your server uses to maintain its state, by default `/var/lib/teleport`.

1. Restart the Teleport service on the server with the new invitation token.

## Next steps

After you have labeled your resources, you can use the labels when running
`tsh` and `tctl` commands to filter the resources that the commands return.
For more information, see [Resource filtering](../../reference/predicate-language.mdx).

You can also use labels to limit the access that different roles have to
specific classes of resources. For more information, see
[Teleport Role Templates](../../access-controls/guides/role-templates.mdx).
